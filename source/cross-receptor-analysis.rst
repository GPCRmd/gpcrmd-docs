=============================
Receptor meta-analysis
=============================

.. contents::
    :depth: 2

About the heatmap:
==================

This plot compares the interaction pattern among several MD simulations, based on the contact frequency of each residue pair of the simulated systems (including protein-protein and protein-ligand interactions).

Interaction frequencies have been calculated with GetContacts_ scripts, created by Rasmus Fonseca (fonseca.rasmus@gmail.com) and Anthony Ma (anthonyma27@gmail.com). Interaction frequencies are considered as the proportion of frames in which a residue pair is interacting, according to `GetContacts interaction criteria`_. For simulations with more than one trajectory available, the average frequencies are obtained.

Based on the frequency values, a clustering analysis is performed to hierarchically classify each simulation. The obtained dendrogram is generated and displayed using plotly_ python library.

Protein residues are labeled using `generic GPCR residue numbers`_ (GPCRdb structure-based numbering). This numbering system differs for each GPCR class, and so a multi-class index has been used on the heatmap's axis.

Only residue pairs with a minimum of 50% interaction frequency in at least one simulation are displayed. Same-helix interactions are not displayed. 

How to use this heatmap:

1. Select the simulation dataset to display in the heatmap. You can filter out simulations provided by individual contributions (not generated by the GPCRmd community) by unselecting this dataset. 
2. Select the type of interaction you want to display. It is also possible to display the "total interaction frequency", which refers to the percentage of frames on which the residue pair is interacting in any of the considered interaction types.
3. Select the partners of the interactions to be displayed (ligand-protein or protein-protein).
4. Select the number of clusters to differentiate on the dendrogram.
5. Check "Show reversed residue pairs" to display interactions for the reversed residue pair (Eg: 5x43-7x32 and 7x32-5x43).
6. Click "Apply" to load the interactions selected.

More information from a selected interaction can be displayed by clicking upon its cell.

About the Top representative interactions in clusters:
======================================================

These plots show the *n* most frequent interactions (on average) in each of the clusters. Interactions are colored based on the average frequency of the interaction within the cluster, according to the same color scale as the heatmap.

Such plots were created using FlarePlots_, by Rasmus Fonseca (fonseca.rasmus@gmail.com) and Anthony Ma (anthonyma27@gmail.com).

How to use them:

1. To select a cluster to display, use the dropup on top of each flareplot. Cluster 1 and Cluster 2 are shown by default.
2. To select a position on the flareplot, click on it. If available, this position will be displayed on the structure viewer below.
3. Press "show in structure" to disable or re-enable the visualization of selected positions.

The viewers at the bottom of the page (based on `NGL viewer`_) display each of the simulations present in the cluster selected in the flareplot.

How to use them:

1. Use the top-right dropdown to select the simulation to display. Notice only simulations of the selected cluster are available.
2. Use the top-left dropdown to select the trajectory file of this simulation to display.
3. Press play to reproduce the simulation on the viewer.
4. Click on any position in the flareplot to display it on the corresponding viewer.
5. For a more detailed visualization of this simulation, click on "open with GPCRmd Workbench".


Customized heatmaps
====================
It is possible to analyze only a specified set of simulations using the Customized heatmaps. For that, use the "Select simulations" dropdown to specify the simulations of interest. Simulations can also be selected by clicking on their dendrogram labels. Once the selection is done, click on "Apply".

New plots showing the interactions of the simulations selected are generated. This allows for a more detailed one-to-one comparison of the interaction pattern of such simulations. 

Please take into account that a large simulation selection may require a long time to load. 


.. _GetContacts: https://github.com/getcontacts/getcontacts
.. _GetContacts interaction criteria: https://submission.gpcrmd.org/contmaps/contmaps/interaction_types
.. _plotly: https://github.com/plotly/plotly.py
.. _Generic GPCR residue numbers: http://docs.gpcrdb.org/generic_numbering.html
.. _FlarePlots: https://github.com/GPCRviz/flareplot
.. _NGL viewer: https://github.com/arose/ngl
